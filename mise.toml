# mise.toml - Task runner configuration for aviato-client
# Run tasks with: mise run <task> or mise r <task>
# Pass additional args: mise run test:e2e -- -p --keep-going

# =============================================================================
# Formatting & Linting
# =============================================================================

[tasks.format]
description = "Format code with ruff"
run = "uv run ruff format ."

[tasks.lint]
description = "Lint code with ruff (auto-fix enabled)"
run = "uv run ruff check --fix ."

[tasks."lint:check"]
description = "Lint code without auto-fix (CI mode)"
run = "uv run ruff check ."

[tasks."format:check"]
description = "Check formatting without changes (CI mode)"
run = "uv run ruff format --check ."

# =============================================================================
# Type Checking
# =============================================================================

[tasks.typecheck]
description = "Run mypy type checking"
run = "uv run mypy src/"
alias = "tc"

# =============================================================================
# Testing
# =============================================================================

[tasks.test]
description = "Run unit tests"
run = "uv run pytest"
alias = "t"

[tasks."test:unit"]
description = "Run unit tests (explicit)"
run = "uv run pytest tests/unit/"

[tasks."test:e2e"]
description = "Run integration/e2e tests (requires auth)"
run = "uv run pytest tests/integration/ -v"
alias = "e2e"

[tasks."test:e2e:parallel"]
description = "Run integration tests in parallel"
run = "uv run pytest tests/integration/ -n auto -v"

[tasks."test:all"]
description = "Run all tests (unit + integration)"
run = "uv run pytest tests/unit/ tests/integration/ -v"

[tasks."test:cov"]
description = "Run unit tests with coverage"
run = "uv run pytest --cov=src --cov-report=term-missing"

# =============================================================================
# Combined Quality Checks
# =============================================================================

[tasks.check]
description = "Run all quality checks (format, lint, typecheck, test)"
run = [
    "uv run ruff format --check .",
    "uv run ruff check .",
    "uv run mypy src/",
    "uv run pytest",
]
alias = "c"

[tasks.ci]
description = "Full CI pipeline (same as check)"
depends = ["check"]

# =============================================================================
# Development Helpers
# =============================================================================

[tasks.install]
description = "Install project dependencies"
run = "uv pip install -e '.[dev]'"

[tasks.clean]
description = "Remove build artifacts and caches"
run = [
    "rm -rf .mypy_cache .pytest_cache .ruff_cache",
    "rm -rf dist build *.egg-info",
    "find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true",
]

[tasks.precommit]
description = "Run pre-commit hooks"
run = "uv run pre-commit run --all-files"
alias = "pc"
